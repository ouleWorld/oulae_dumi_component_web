"use strict";(self.webpackChunkoulae_dumi_component_web=self.webpackChunkoulae_dumi_component_web||[]).push([[565],{9565:function(za,Gn,P){P.r(Gn),P.d(Gn,{PopoverDialog:function(){return aa},ReactWindowStickyCells:function(){return fa},RelationComponent:function(){return Fa}});var zn=P(42122),B=P.n(zn),Hn=P(27424),z=P.n(Hn),f=P(67294),Kn=P(73935),Zn={bodyMastRoot:"cq7hzOIX941CzaFrgA9O",mask:"WBzMgNsaKYQG8qJnTjOC"},e=P(85893),Qn=f.useEffect,Xn=f.useRef,Ln=function(a){var t=a.visible,i=a.children,u=a.style,n=u===void 0?{}:u,l=a.maskBgColor,s=a.maskClickFn,v=Xn(document.createElement("div"));return Qn(function(){document.body.appendChild(v.current)}),t&&Kn.createPortal((0,e.jsxs)("div",{className:Zn.bodyMastRoot,children:[(0,e.jsx)("div",{className:Zn.mask,style:B()({backgroundColor:l},n),onClick:function(){s==null||s(),console.log("\u70B9\u51FB\u4E86 mask")}}),i]}),v.current)};Ln.defaultProps={style:{},maskBgColor:"rgba(0, 0, 0, 0.45)"};var Jn=Ln,Yn={container:"d7Pmi8i_xXs2VnTwQQOi"},q=f.useState,Un=f.useEffect,qn=f.useImperativeHandle,yn=f.useRef,xn=f.forwardRef,Sn=function(a,t,i,u,n,l){var s=l.x,v=l.y,c=l.right,m=l.bottom,N=window.innerWidth,p=window.innerHeight,j=void 0;return i==="top"?j=t+n<v:i==="right"?j=a>c:i==="bottom"?j=t>m:i==="left"&&(j=a+u<s),j&&a>0&&a+u<N&&t>0&&t+n<p},_n=function(a,t,i,u,n){var l=a,s=t;return l<=0&&(l=n),l+i>window.innerWidth&&(l-=l+i-window.innerWidth+n),s<=0&&(s=n),s+u>window.innerHeight&&(s-=s+u-window.innerHeight+n),{left:l,top:s}},na=function(a,t){var i=a.bodyMaskStyle,u=i===void 0?{}:i,n=a.mode,l=n===void 0?"leftRight":n,s=a.diff,v=s===void 0?10:s,c=a.containerWidthPx,m=c===void 0?0:c,N=a.containerHeightPx,p=N===void 0?0:N,j=yn(null),M=q(!1),A=z()(M,2),w=A[0],h=A[1],o=q(m),d=z()(o,2),E=d[0],D=d[1],K=q(p),x=z()(K,2),k=x[0],S=x[1],wn=q({top:0,left:0}),mn=z()(wn,2),_=mn[0],Q=mn[1],gn=q(!1),X=z()(gn,2),L=X[0],nn=X[1],An=q({}),pn=z()(An,2),ln=pn[0],an=pn[1],I=function(C,g,b,V){return Sn(C,g,b,E,k,V)?(Q({left:C,top:g}),h(!0),{left:C,top:g}):!1},F=function(C){return function(g){var b=g.x,V=g.y,O=g.width,Y=g.height,fn=g.right,en=g.bottom,rn=b+O/2,W=V+Y/2,G=-1,Z=-1;if(C==="top"?(G=rn-E/2,Z=V-k-10):C==="right"?(G=fn+10,Z=W-k/2):C==="bottom"?(G=rn-E/2,Z=en+10):C==="left"&&(G=b-E-10,Z=W-k/2),I(G,Z,C,g))return!0;var tn=_n(G,Z,E,k,v);return G=tn.left,Z=tn.top,!!I(G,Z,C,g)}},J=function(C){var g=[];l==="leftRight"?(g.push(F("right")),g.push(F("left"))):l==="topBottom"?(g.push(F("top")),g.push(F("bottom"))):l==="auto"&&(g.push(F("top")),g.push(F("right")),g.push(F("bottom")),g.push(F("left")));for(var b=0,V=g.length;b<V;b++){var O=g[b](C);if(O)break}nn(!1),h(!0)};return Un(function(){L&&E&&k&&J(ln)},[L,E,k]),qn(t,function(){return{show:function(C){if(an(C),m===0&&p===0){h(!0),nn(!0),D(0),S(0),setTimeout(function(){var g,b=j==null||(g=j.current)===null||g===void 0?void 0:g.getBoundingClientRect(),V=b.width,O=b.height;D(V),S(O)});return}J(C)},hide:function(){h(!1)}}}),(0,e.jsx)(Jn,{visible:w,style:B()({},u),maskBgColor:"transform",maskClickFn:function(){h(!1)},children:(0,e.jsx)("div",{ref:j,className:Yn.container,style:B()({visibility:L?"hidden":"visible"},_),children:a.children})})},aa=xn(na),ea=P(70215),ra=P.n(ea),ta=P(91907);function oa(r){return{row:r.props.rowIndex,column:r.props.columnIndex}}function ia(r){var a=1/0,t=-1/0,i=1/0,u=-1/0;return f.Children.forEach(r,function(n){var l=oa(n),s=l.row,v=l.column;a=Math.min(a,s),t=Math.max(t,s),i=Math.min(i,v),u=Math.max(u,v)}),{from:{row:a,column:i},to:{row:t,column:u}}}function la(r){return(0,e.jsx)("div",{className:"containerTopLeft",children:r.children})}function ua(r){return(0,e.jsx)("div",{className:"containerTopRight",children:r.children})}function sa(r){var a=r.height;return(0,e.jsx)("div",{className:"containerTop",style:{height:a},children:r.children})}function va(r){var a=r.height;return(0,e.jsx)("div",{className:"containerLeft",style:{height:a},children:r.children})}function ha(r){var a=r.height;return(0,e.jsx)("div",{className:"containerRight",style:{height:a},children:r.children})}function ca(r){var a=r.height;return(0,e.jsx)("div",{className:"containerBottom",style:{height:a},children:r.children})}function da(r){return(0,e.jsx)("div",{className:"containerBottomLeft",children:r.children})}function ma(r){return(0,e.jsx)("div",{className:"containerBottomRight",children:r.children})}var ga=["fixedStyle"];function pa(r,a,t,i,u,n){return f.useMemo(function(){return f.forwardRef(function(l,s){function v(T){for(var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,U=T,cn=0;U>R;)cn+=t(U-1),U-=1;return cn}function c(T){for(var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,U=T,cn=0;U>R;)cn+=a(U-1),U-=1;return cn}var m=ia(l.children),N=f.Children.map(l.children,function(T){return T}),p=m.to.column-m.from.column,j=m.to.row-m.from.row,M=[];if(n!=null&&n.top&&n!==null&&n!==void 0&&n.left)for(var A=0;A<(n==null?void 0:n.top);A++){M[A]=[];for(var w=0;w<(n==null?void 0:n.left);w++){var h=w,o=A,d=a(h),E=t(o);M[A].push(f.createElement(r,{key:"".concat(o,":").concat(h),rowIndex:o,columnIndex:h,style:{display:"inline-flex",width:d,height:E}}))}}var D=[];if(n!=null&&n.top&&n!==null&&n!==void 0&&n.right)for(var K=0;K<(n==null?void 0:n.top);K++){D[K]=[];for(var x=n==null?void 0:n.right;x>0;x--){var k=i-x,S=K,wn=a(k),mn=t(S);D[K].push(f.createElement(r,{key:"".concat(S,":").concat(k),rowIndex:S,columnIndex:k,style:{display:"inline-flex",width:wn,height:mn}}))}}var _=[];if(n!=null&&n.top)for(var Q=0;Q<(n==null?void 0:n.top);Q++){_[Q]=[];var gn=p;n!=null&&n.right&&(gn-=n==null?void 0:n.right);for(var X=(n==null?void 0:n.left)||0;X<=gn;X+=1){var L=m.from.column+X,nn=Q,An=a(L),pn=t(nn),ln=void 0;X===((n==null?void 0:n.left)||0)&&(n!=null&&n.left?ln=c(L,n==null?void 0:n.left):ln=c(L)),_[Q].push(f.createElement(r,{key:"".concat(nn,":").concat(L),rowIndex:nn,columnIndex:L,style:{marginLeft:ln,display:"inline-flex",width:An,height:pn,zIndex:3}}))}}var an=[];if(n!=null&&n.left)for(var I=0;I<(n==null?void 0:n.left);I++){an[I]=[];var F=j;n!=null&&n.bottom&&(F-=n==null?void 0:n.bottom);for(var J=(n==null?void 0:n.top)||0;J<=F;J+=1){var $=I,C=J+m.from.row,g=a($),b=t(C),V=void 0;J===((n==null?void 0:n.top)||0)&&(n!=null&&n.top?V=v(C,n==null?void 0:n.top):V=v(C)),an[I].push(f.createElement(r,{key:"".concat(C,":").concat($),rowIndex:C,columnIndex:$,style:{marginTop:V,display:"inline-flex",width:g,height:b,zIndex:3}}))}}var O=[];if(n!=null&&n.right)for(var Y=0;Y<(n==null?void 0:n.right);Y++){O[Y]=[];var fn=j;n!=null&&n.bottom&&(fn-=n==null?void 0:n.bottom);for(var en=(n==null?void 0:n.top)||0;en<=fn;en+=1){var rn=i-Y-1,W=en+m.from.row,G=a(rn),Z=t(W),tn=void 0;en===((n==null?void 0:n.top)||0)&&(n!=null&&n.top?tn=v(W,n==null?void 0:n.top):tn=v(W)),O[Y].push(f.createElement(r,{key:"".concat(W,":").concat(rn),rowIndex:W,columnIndex:rn,style:{marginTop:tn,display:"inline-flex",width:G,height:Z,zIndex:3}}))}}var Cn=[];if(n!=null&&n.bottom)for(var un=0;un<(n==null?void 0:n.bottom);un++){Cn[un]=[];var Wn=p;n!=null&&n.right&&(Wn-=n==null?void 0:n.right);for(var Tn=(n==null?void 0:n.left)||0;Tn<=Wn;Tn+=1){var sn=m.from.column+Tn,Dn=u-un-1,Oa=a(sn),Ga=t(Dn),bn=void 0;Tn===((n==null?void 0:n.left)||0)&&(n!=null&&n.left?bn=c(sn,n==null?void 0:n.left):bn=c(sn)),Cn[un].push(f.createElement(r,{key:"".concat(Dn,":").concat(sn),rowIndex:Dn,columnIndex:sn,style:{marginLeft:bn,display:"inline-flex",width:Oa,height:Ga,zIndex:3}}))}}var jn=[];if(n!=null&&n.bottom&&n!==null&&n!==void 0&&n.left)for(var vn=0;vn<(n==null?void 0:n.bottom);vn++){jn[vn]=[];for(var Mn=0;Mn<(n==null?void 0:n.left);Mn++){var Vn=Mn,Bn=u-vn-1,Za=a(Vn),La=t(Bn);jn[vn].push(f.createElement(r,{key:"".concat(Bn,":").concat(Vn),rowIndex:Bn,columnIndex:Vn,style:{display:"inline-flex",width:Za,height:La}}))}}var Rn=[];if(n!=null&&n.bottom&&n!==null&&n!==void 0&&n.right)for(var hn=0;hn<(n==null?void 0:n.bottom);hn++){Rn[hn]=[];for(var kn=n==null?void 0:n.right;kn>0;kn--){var Fn=i-kn,On=u-hn-1,$a=a(Fn),Ia=t(On);Rn[hn].push(f.createElement(r,{key:"".concat(On,":").concat(Fn),rowIndex:On,columnIndex:Fn,style:{display:"inline-flex",width:$a,height:Ia}}))}}var Wa=v(u-(n.bottom||0),n.top||0);return(0,e.jsxs)("div",B()(B()({ref:s},l),{},{className:"reactWindowStickyCellsContainer",children:[M.length?(0,e.jsx)(la,{children:M.map(function(T,R){return(0,e.jsx)("div",{style:{width:"fit-content"},children:T},R)})}):null,D.length?(0,e.jsx)(ua,{children:D.map(function(T,R){return(0,e.jsx)("div",{style:{width:"fit-content"},children:T},R)})}):null,_.length?(0,e.jsx)(sa,{height:v(n==null?void 0:n.top),children:_.map(function(T,R){return(0,e.jsx)("div",{children:T},R)})}):null,an.length?(0,e.jsx)(va,{children:an.map(function(T,R){return(0,e.jsx)("div",{className:"leftContainer",style:{width:"fit-content",height:"fit-content",display:"flex",flexDirection:"column"},children:T},R)})}):null,O.length?(0,e.jsx)(ha,{children:O.map(function(T,R){return(0,e.jsx)("div",{className:"rightContainer",style:{width:"fit-content",height:"fit-content",display:"flex",flexDirection:"column"},children:T},R)})}):null,(0,e.jsx)("div",{className:"childrenContainer",style:{height:"".concat(Wa,"px")},children:N}),jn.length?(0,e.jsx)(da,{children:jn.reverse().map(function(T,R){return(0,e.jsx)("div",{style:{width:"fit-content"},children:T},R)})}):null,Rn.length?(0,e.jsx)(ma,{children:Rn.reverse().map(function(T,R){return(0,e.jsx)("div",{style:{width:"fit-content"},children:T},R)})}):null,Cn.length?(0,e.jsx)(ca,{height:v(u,u-(n==null?void 0:n.bottom)),children:Cn.reverse().map(function(T,R){return(0,e.jsx)("div",{children:T},R)})}):null]}))})},[r,a,t,i,u,n])}function fa(r){var a=r.fixedStyle,t=ra()(r,ga);return(0,e.jsx)(ta.cd,B()(B()({},t),{},{innerElementType:pa(t.children,t.columnWidth,t.rowHeight,t.columnCount,t.rowCount,a)}))}var y=P(90783),dn=P(55970),Ca=P(68775),Nn=y.Z.Option,$n=function(a){var t=a.data,i=a.pos,u=a.onChange,n=a.keyMap,l=a.handleMap,s=a.valueMap,v=a.defaultValueStatus,c=t.key,m=t.op,N=t.value,p=function(d){typeof u=="function"&&u(d)},j=function(d){p({key:d})},M=function(d){p({op:d})},A=function(d){p({value:d.target.value})},w=function(d){p({value:d})},h=function(){var d;return c?(d=s[c])!==null&&d!==void 0&&d.length?(0,e.jsx)(dn.Z.Item,{name:["relations_validate",i,"value_value"],initialValue:N,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u64CD\u4F5C\u503C"}],style:{marginRight:"6px"},children:(0,e.jsx)(y.Z,{placeholder:"\u8BF7\u9009\u62E9\u64CD\u4F5C\u503C",onChange:w,children:s[c].map(function(E,D){return(0,e.jsx)(Nn,{value:E.value,children:E.label},D)})})}):(0,e.jsx)(dn.Z.Item,{name:["relations_validate",i,"value_value"],initialValue:N,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u64CD\u4F5C\u503C"}],style:{marginRight:"6px"},children:(0,e.jsx)(Ca.Z,{placeholder:"\u8BF7\u8F93\u5165\u64CD\u4F5C\u503C",value:N,onChange:A})}):null};return(0,f.useEffect)(function(){v&&p({key:n[0].value,op:l[0].value})},[]),(0,e.jsxs)("div",{className:"term",children:[(0,e.jsx)("span",{className:"element",children:(0,e.jsx)(dn.Z.Item,{name:["relations_validate",i,"element_value"],initialValue:c,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6761\u4EF6"}],style:{marginRight:"6px"},children:(0,e.jsx)(y.Z,{placeholder:"\u8BF7\u9009\u62E9\u6761\u4EF6\u9879",onChange:j,children:n.map(function(o,d){return(0,e.jsx)(Nn,{value:o.value,children:o.label},d)})})})}),(0,e.jsx)("span",{className:"comparison",children:(0,e.jsx)(dn.Z.Item,{name:["relations_validate",i,"comparison_value"],initialValue:m,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5173\u7CFB\u7B26"}],style:{marginRight:"6px"},children:(0,e.jsx)(y.Z,{placeholder:"\u8BF7\u9009\u62E9\u5173\u7CFB\u7B26",onChange:M,children:l.map(function(o,d){return(0,e.jsx)(Nn,{value:o.value,children:o.label},d)})})})}),(0,e.jsx)("span",{className:"value",children:h()})]})};$n.defaultProps={defaultValueStatus:!1};var Ta=$n,ja=P(12902),En=P(76260),Ra=function(a){var t=a.data,i=a.pos,u=a.setElementTerm,n=a.onDeleteTerm,l=a.onTermChange,s=function(){typeof n=="function"&&n(i,t)},v=function(m){typeof l=="function"&&l(i,B()(B()({},t),m))};return typeof u!="function"?(console.error("setElementTerm \u5C5E\u6027\u5FC5\u987B\u8BBE\u7F6E\uFF0C\u4E14\u5FC5\u987B\u662F\u8FD4\u56DE ReactElement \u7684Function"),null):(0,e.jsxs)("div",{className:"vui-relation-item",children:[u(t,i,v),(0,e.jsx)(En.ZP,{type:"primary",danger:!0,onClick:s,className:"delete-term",children:"\u5220\u9664"})]})},Na=Ra,Ea=y.Z.Option,Pn="_",Pa=function(a,t){return a?"".concat(a).concat(Pn).concat(t):String(t)},In=function(a){return a&&a.split(Pn)||[]},wa=[{label:"\u6216",value:"and"},{label:"\u4E14",value:"or"}],Aa=function r(a){var t=a.data,i=a.pos,u=a.setElementTerm,n=a.onAddGroup,l=a.onAddTerm,s=a.onOpsChange,v=a.onDeleteTerm,c=a.onTermChange,m=function(){var o=In(i),d=t.children;return o.push(String(d.length-1)),o.join(Pn)},N=function(o){typeof s=="function"&&s(i,B()(B()({},t),{},{ops:o}))},p=function(){var o={},d=m();typeof l=="function"&&l(d,o)},j=function(){var o={ops:on.AND,children:[{}]},d=m();typeof n=="function"&&n(d,o)},M=t.children,A=t.ops,w=A||on.AND;return console.log("RelationGroup data: ",t),(0,e.jsxs)("div",{className:"vui-relation-group",children:[(0,e.jsx)("div",{className:"relational",children:(0,e.jsx)(y.Z,{className:"relation-sign",value:w,onChange:N,children:wa.map(function(h,o){return(0,e.jsx)(Ea,{value:h.value,children:h.label},o)})})}),(0,e.jsxs)("div",{className:"conditions",children:[M.map(function(h,o){var d=h,E=d.children,D=Pa(i,o);return E&&E.length?(0,e.jsx)(r,{pos:D,data:h,setElementTerm:u,onAddGroup:n,onAddTerm:l,onOpsChange:s,onDeleteTerm:v,onTermChange:c},D):(0,e.jsx)(Na,{pos:D,data:h,setElementTerm:u,onDeleteTerm:v,onTermChange:c},D)}),(0,e.jsxs)("div",{className:"operators",children:[(0,e.jsx)(En.ZP,{type:"primary",className:"add-term",onClick:p,children:"\u52A0\u6761\u4EF6"}),(0,e.jsx)(En.ZP,{type:"primary",className:"add-group",onClick:j,children:"\u52A0\u6761\u4EF6\u7EC4"})]})]})]})},Da=Aa,ba=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0;if(!t)return u;var n=In(t),l=n.length-1;return(0,ja.ZP)(a,function(s){var v={data:s,idx:0},c=s.children||[];n.forEach(function(m,N){var p=Number(m);if(N===l)switch(i){case"addTerm":case"addGroup":c.splice(p+1,0,u);break;case"deleteTerm":c.splice(p,1),c.length||v.data.splice(v.idx,1);break;default:c[p]=u}else v={data:c,idx:p},c=c[p]&&c[p].children||[]})})},on;(function(r){r.AND="and",r.OR="or"})(on||(on={}));var H;(function(r){r.addGroup="addGroup",r.addTerm="addTerm",r.changeOps="changeOps",r.deleteTerm="deleteTerm",r.changeTerm="changeTerm"})(H||(H={}));var Ma={ops:on.AND,children:[{}]},Va=function(a){var t=a.value,i=a.onValueChange,u=a.setElementTerm,n=a.fromItemOnChange,l=(0,f.useState)(t||Ma),s=z()(l,2),v=s[0],c=s[1];(0,f.useEffect)(function(){n&&n(v)},[v]);var m=function(h,o,d){var E=ba(v,h,d,o);typeof i=="function"&&i(E,d,o),c(E)},N=function(h,o){m(h,o,H.addGroup)},p=function(h,o){m(h,o,H.addTerm)},j=function(h,o){m(h,o,H.changeOps)},M=function(h,o){m(h,o,H.deleteTerm)},A=function(h,o){m(h,o,H.changeTerm)};return(0,e.jsx)("div",{className:"vui-relation-tree",children:(0,e.jsx)(Da,{pos:"",data:v,setElementTerm:u,onAddGroup:N,onAddTerm:p,onOpsChange:j,onDeleteTerm:M,onTermChange:A})})},Ba=Va,ka=function(a){var t=a.keyMap,i=a.handleMap,u=a.value,n=a.valueMap,l=a.onValueChange,s=function(c,m,N){return(0,e.jsx)(Ta,{keyMap:t,handleMap:i,valueMap:n,pos:m,data:c,onChange:N})};return(0,e.jsx)(Ba,{value:u,onValueChange:l,fromItemOnChange:a.onChange,setElementTerm:s})},Fa=ka}}]);
