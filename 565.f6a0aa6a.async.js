"use strict";(self.webpackChunkoulae_dumi_component_web=self.webpackChunkoulae_dumi_component_web||[]).push([[565],{9565:function(Ie,On,E){E.r(On),E.d(On,{PopoverDialog:function(){return _n},ReactWindowStickyCells:function(){return ge},RelationComponent:function(){return Be}});var In=E(42122),F=E.n(In),Wn=E(27424),W=E.n(Wn),f=E(67294),zn=E(73935),Gn={bodyMastRoot:"cq7hzOIX941CzaFrgA9O",mask:"WBzMgNsaKYQG8qJnTjOC"},a=E(85893),Hn=f.useEffect,Kn=f.useRef,Zn=function(e){var t=e.visible,i=e.children,u=e.style,n=u===void 0?{}:u,l=e.maskBgColor,s=e.maskClickFn,v=Kn(document.createElement("div"));return Hn(function(){document.body.appendChild(v.current)}),t&&zn.createPortal((0,a.jsxs)("div",{className:Gn.bodyMastRoot,children:[(0,a.jsx)("div",{className:Gn.mask,style:F()({backgroundColor:l},n),onClick:function(){s==null||s(),console.log("\u70B9\u51FB\u4E86 mask")}}),i]}),v.current)};Zn.defaultProps={style:{},maskBgColor:"rgba(0, 0, 0, 0.45)"};var Qn=Zn,Xn={container:"d7Pmi8i_xXs2VnTwQQOi"},U=f.useState,Jn=f.useEffect,Yn=f.useImperativeHandle,Un=f.useRef,qn=f.forwardRef,yn=function(e,t,i,u,n,l){var s=l.x,v=l.y,c=l.right,m=l.bottom,R=window.innerWidth,p=window.innerHeight,T=void 0;return i==="top"?T=t+n<v:i==="right"?T=e>c:i==="bottom"?T=t>m:i==="left"&&(T=e+u<s),T&&e>0&&e+u<R&&t>0&&t+n<p},xn=function(e,t,i,u,n){var l=e,s=t;return l<=0&&(l=n),l+i>window.innerWidth&&(l-=l+i-window.innerWidth+n),s<=0&&(s=n),s+u>window.innerHeight&&(s-=s+u-window.innerHeight+n),{left:l,top:s}},Sn=function(e,t){var i=e.bodyMaskStyle,u=i===void 0?{}:i,n=e.mode,l=n===void 0?"leftRight":n,s=e.diff,v=s===void 0?10:s,c=e.containerWidthPx,m=c===void 0?0:c,R=e.containerHeightPx,p=R===void 0?0:R,T=Un(null),B=U(!1),D=W()(B,2),w=D[0],h=D[1],o=U(m),d=W()(o,2),N=d[0],b=d[1],H=U(p),y=W()(H,2),O=y[0],x=y[1],Pn=U({top:0,left:0}),mn=W()(Pn,2),S=mn[0],K=mn[1],_=U(!1),$=W()(_,2),Q=$[0],gn=$[1],wn=U({}),nn=W()(wn,2),en=nn[0],X=nn[1],on=function(P,g,A,V){return yn(P,g,A,N,O,V)?(K({left:P,top:g}),h(!0),{left:P,top:g}):!1},M=function(P){return function(g){var A=g.x,V=g.y,Z=g.width,pn=g.height,rn=g.right,ln=g.bottom,I=A+Z/2,fn=V+pn/2,L=-1,k=-1;if(P==="top"?(L=I-N/2,k=V-O-10):P==="right"?(L=rn+10,k=fn-O/2):P==="bottom"?(L=I-N/2,k=ln+10):P==="left"&&(L=A-N-10,k=fn-O/2),on(L,k,P,g))return!0;var J=xn(L,k,N,O,v);return L=J.left,k=J.top,!!on(L,k,P,g)}},an=function(P){var g=[];l==="leftRight"?(g.push(M("right")),g.push(M("left"))):l==="topBottom"?(g.push(M("top")),g.push(M("bottom"))):l==="auto"&&(g.push(M("top")),g.push(M("right")),g.push(M("bottom")),g.push(M("left")));for(var A=0,V=g.length;A<V;A++){var Z=g[A](P);if(Z)break}gn(!1),h(!0)};return Jn(function(){Q&&N&&O&&an(en)},[Q,N,O]),Yn(t,function(){return{show:function(P){if(X(P),m===0&&p===0){h(!0),gn(!0),b(0),x(0),setTimeout(function(){var g,A=T==null||(g=T.current)===null||g===void 0?void 0:g.getBoundingClientRect(),V=A.width,Z=A.height;b(V),x(Z)});return}an(P)},hide:function(){h(!1)}}}),(0,a.jsx)(Qn,{visible:w,style:F()({},u),maskBgColor:"transform",maskClickFn:function(){h(!1)},children:(0,a.jsx)("div",{ref:T,className:Xn.container,style:F()({visibility:Q?"hidden":"visible"},S),children:e.children})})},_n=qn(Sn),ne=E(70215),ee=E.n(ne),ae=E(91907);function re(r){return{row:r.props.rowIndex,column:r.props.columnIndex}}function te(r){var e=1/0,t=-1/0,i=1/0,u=-1/0;return f.Children.forEach(r,function(n){var l=re(n),s=l.row,v=l.column;e=Math.min(e,s),t=Math.max(t,s),i=Math.min(i,v),u=Math.max(u,v)}),{from:{row:e,column:i},to:{row:t,column:u}}}function oe(r){return(0,a.jsx)("div",{className:"containerTopLeft",children:r.children})}function ie(r){return(0,a.jsx)("div",{className:"containerTopRight",children:r.children})}function le(r){var e=r.height;return(0,a.jsx)("div",{className:"containerTop",style:{height:e},children:r.children})}function ue(r){var e=r.height;return(0,a.jsx)("div",{className:"containerLeft",style:{height:e},children:r.children})}function se(r){var e=r.height;return(0,a.jsx)("div",{className:"containerRight",style:{height:e},children:r.children})}function ve(r){var e=r.height;return(0,a.jsx)("div",{className:"containerBottom",style:{height:e},children:r.children})}function he(r){return(0,a.jsx)("div",{className:"containerBottomLeft",children:r.children})}function ce(r){return(0,a.jsx)("div",{className:"containerBottomRight",children:r.children})}var de=["fixedStyle"];function me(r,e,t,i,u,n){return f.useMemo(function(){return f.forwardRef(function(l,s){function v(C){for(var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Y=C,cn=0;Y>j;)cn+=t(Y-1),Y-=1;return cn}function c(C){for(var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Y=C,cn=0;Y>j;)cn+=e(Y-1),Y-=1;return cn}var m=te(l.children),R=f.Children.map(l.children,function(C){return C}),p=m.to.column-m.from.column,T=m.to.row-m.from.row,B=[];if(n!=null&&n.top&&n!==null&&n!==void 0&&n.left)for(var D=0;D<(n==null?void 0:n.top);D++){B[D]=[];for(var w=0;w<(n==null?void 0:n.left);w++){var h=w,o=D,d=e(h),N=t(o);B[D].push(f.createElement(r,{key:"".concat(o,":").concat(h),rowIndex:o,columnIndex:h,style:{display:"inline-flex",width:d,height:N}}))}}var b=[];if(n!=null&&n.top&&n!==null&&n!==void 0&&n.right)for(var H=0;H<(n==null?void 0:n.top);H++){b[H]=[];for(var y=n==null?void 0:n.right;y>0;y--){var O=i-y,x=H,Pn=e(O),mn=t(x);b[H].push(f.createElement(r,{key:"".concat(x,":").concat(O),rowIndex:x,columnIndex:O,style:{display:"inline-flex",width:Pn,height:mn}}))}}var S=[];if(n!=null&&n.top)for(var K=0;K<(n==null?void 0:n.top);K++){S[K]=[];for(var _=(n==null?void 0:n.left)||0;_<=p;_+=1){var $=m.from.column+_,Q=K,gn=e($),wn=t(Q),nn=void 0;_===((n==null?void 0:n.left)||0)&&(n!=null&&n.left?nn=c($,n==null?void 0:n.left):nn=c($)),S[K].push(f.createElement(r,{key:"".concat(Q,":").concat($),rowIndex:Q,columnIndex:$,style:{marginLeft:nn,display:"inline-flex",width:gn,height:wn,zIndex:3}}))}}var en=[];if(n!=null&&n.left)for(var X=0;X<(n==null?void 0:n.left);X++){en[X]=[];var on=T;n!=null&&n.bottom&&(on-=n==null?void 0:n.bottom);for(var M=(n==null?void 0:n.top)||0;M<=on;M+=1){var an=X,G=M+m.from.row,P=e(an),g=t(G),A=void 0;M===((n==null?void 0:n.top)||0)&&(n!=null&&n.top?A=v(G,n==null?void 0:n.top):A=v(G)),en[X].push(f.createElement(r,{key:"".concat(G,":").concat(an),rowIndex:G,columnIndex:an,style:{marginTop:A,display:"inline-flex",width:P,height:g,zIndex:3}}))}}var V=[];if(n!=null&&n.right)for(var Z=0;Z<(n==null?void 0:n.right);Z++){V[Z]=[];var pn=T;n!=null&&n.bottom&&(pn-=n==null?void 0:n.bottom);for(var rn=(n==null?void 0:n.top)||0;rn<=pn;rn+=1){var ln=i-Z-1,I=rn+m.from.row,fn=e(ln),L=t(I),k=void 0;rn===((n==null?void 0:n.top)||0)&&(n!=null&&n.top?k=v(I,n==null?void 0:n.top):k=v(I)),V[Z].push(f.createElement(r,{key:"".concat(I,":").concat(ln),rowIndex:I,columnIndex:ln,style:{marginTop:k,display:"inline-flex",width:fn,height:L,zIndex:3}}))}}var J=[];if(n!=null&&n.bottom)for(var un=0;un<(n==null?void 0:n.bottom);un++){J[un]=[];for(var Cn=(n==null?void 0:n.left)||0;Cn<=p;Cn+=1){var sn=m.from.column+Cn,An=u-un-1,ke=e(sn),Fe=t(An),Dn=void 0;Cn===((n==null?void 0:n.left)||0)&&(n!=null&&n.left?Dn=c(sn,n==null?void 0:n.left):Dn=c(sn)),J[un].push(f.createElement(r,{key:"".concat(An,":").concat(sn),rowIndex:An,columnIndex:sn,style:{marginLeft:Dn,display:"inline-flex",width:ke,height:Fe,zIndex:3}}))}}var Tn=[];if(n!=null&&n.bottom&&n!==null&&n!==void 0&&n.left)for(var vn=0;vn<(n==null?void 0:n.bottom);vn++){Tn[vn]=[];for(var bn=0;bn<(n==null?void 0:n.left);bn++){var Mn=bn,Vn=u-vn-1,Oe=e(Mn),Ge=t(Vn);Tn[vn].push(f.createElement(r,{key:"".concat(Vn,":").concat(Mn),rowIndex:Vn,columnIndex:Mn,style:{display:"inline-flex",width:Oe,height:Ge}}))}}var jn=[];if(n!=null&&n.bottom&&n!==null&&n!==void 0&&n.right)for(var hn=0;hn<(n==null?void 0:n.bottom);hn++){jn[hn]=[];for(var Bn=n==null?void 0:n.right;Bn>0;Bn--){var kn=i-Bn,Fn=u-hn-1,Ze=e(kn),Le=t(Fn);jn[hn].push(f.createElement(r,{key:"".concat(Fn,":").concat(kn),rowIndex:Fn,columnIndex:kn,style:{display:"inline-flex",width:Ze,height:Le}}))}}var $e=v(u-(n.bottom||0),n.top||0);return(0,a.jsxs)("div",F()(F()({ref:s},l),{},{className:"reactWindowStickyCellsContainer",children:[B.length?(0,a.jsx)(oe,{children:B.map(function(C,j){return(0,a.jsx)("div",{style:{width:"fit-content"},children:C},j)})}):null,b.length?(0,a.jsx)(ie,{children:b.map(function(C,j){return(0,a.jsx)("div",{style:{width:"fit-content"},children:C},j)})}):null,S.length?(0,a.jsx)(le,{height:v(n==null?void 0:n.top),children:S.map(function(C,j){return(0,a.jsx)("div",{children:C},j)})}):null,en.length?(0,a.jsx)(ue,{children:en.map(function(C,j){return(0,a.jsx)("div",{className:"leftContainer",style:{width:"fit-content",height:"fit-content",display:"flex",flexDirection:"column"},children:C},j)})}):null,V.length?(0,a.jsx)(se,{children:V.map(function(C,j){return(0,a.jsx)("div",{className:"rightContainer",style:{width:"fit-content",height:"fit-content",display:"flex",flexDirection:"column"},children:C},j)})}):null,(0,a.jsx)("div",{className:"childrenContainer",style:{height:"".concat($e,"px")},children:R}),Tn.length?(0,a.jsx)(he,{children:Tn.reverse().map(function(C,j){return(0,a.jsx)("div",{style:{width:"fit-content"},children:C},j)})}):null,jn.length?(0,a.jsx)(ce,{children:jn.reverse().map(function(C,j){return(0,a.jsx)("div",{style:{width:"fit-content"},children:C},j)})}):null,J.length?(0,a.jsx)(ve,{height:v(u,u-(n==null?void 0:n.bottom)),children:J.reverse().map(function(C,j){return(0,a.jsx)("div",{children:C},j)})}):null]}))})},[r,e,t,i,u,n])}function ge(r){var e=r.fixedStyle,t=ee()(r,de);return(0,a.jsx)(ae.cd,F()(F()({},t),{},{innerElementType:me(t.children,t.columnWidth,t.rowHeight,t.columnCount,t.rowCount,e)}))}var q=E(90783),dn=E(55970),pe=E(68775),Rn=q.Z.Option,Ln=function(e){var t=e.data,i=e.pos,u=e.onChange,n=e.keyMap,l=e.handleMap,s=e.valueMap,v=e.defaultValueStatus,c=t.key,m=t.op,R=t.value,p=function(d){typeof u=="function"&&u(d)},T=function(d){p({key:d})},B=function(d){p({op:d})},D=function(d){p({value:d.target.value})},w=function(d){p({value:d})},h=function(){var d;return c?(d=s[c])!==null&&d!==void 0&&d.length?(0,a.jsx)(dn.Z.Item,{name:["relations_validate",i,"value_value"],initialValue:R,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u64CD\u4F5C\u503C"}],style:{marginRight:"6px"},children:(0,a.jsx)(q.Z,{placeholder:"\u8BF7\u9009\u62E9\u64CD\u4F5C\u503C",onChange:w,children:s[c].map(function(N,b){return(0,a.jsx)(Rn,{value:N.value,children:N.label},b)})})}):(0,a.jsx)(dn.Z.Item,{name:["relations_validate",i,"value_value"],initialValue:R,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u64CD\u4F5C\u503C"}],style:{marginRight:"6px"},children:(0,a.jsx)(pe.Z,{placeholder:"\u8BF7\u8F93\u5165\u64CD\u4F5C\u503C",value:R,onChange:D})}):null};return(0,f.useEffect)(function(){v&&p({key:n[0].value,op:l[0].value})},[]),(0,a.jsxs)("div",{className:"term",children:[(0,a.jsx)("span",{className:"element",children:(0,a.jsx)(dn.Z.Item,{name:["relations_validate",i,"element_value"],initialValue:c,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6761\u4EF6"}],style:{marginRight:"6px"},children:(0,a.jsx)(q.Z,{placeholder:"\u8BF7\u9009\u62E9\u6761\u4EF6\u9879",onChange:T,children:n.map(function(o,d){return(0,a.jsx)(Rn,{value:o.value,children:o.label},d)})})})}),(0,a.jsx)("span",{className:"comparison",children:(0,a.jsx)(dn.Z.Item,{name:["relations_validate",i,"comparison_value"],initialValue:m,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5173\u7CFB\u7B26"}],style:{marginRight:"6px"},children:(0,a.jsx)(q.Z,{placeholder:"\u8BF7\u9009\u62E9\u5173\u7CFB\u7B26",onChange:B,children:l.map(function(o,d){return(0,a.jsx)(Rn,{value:o.value,children:o.label},d)})})})}),(0,a.jsx)("span",{className:"value",children:h()})]})};Ln.defaultProps={defaultValueStatus:!1};var fe=Ln,Ce=E(12902),Nn=E(76260),Te=function(e){var t=e.data,i=e.pos,u=e.setElementTerm,n=e.onDeleteTerm,l=e.onTermChange,s=function(){typeof n=="function"&&n(i,t)},v=function(m){typeof l=="function"&&l(i,F()(F()({},t),m))};return typeof u!="function"?(console.error("setElementTerm \u5C5E\u6027\u5FC5\u987B\u8BBE\u7F6E\uFF0C\u4E14\u5FC5\u987B\u662F\u8FD4\u56DE ReactElement \u7684Function"),null):(0,a.jsxs)("div",{className:"vui-relation-item",children:[u(t,i,v),(0,a.jsx)(Nn.ZP,{type:"primary",danger:!0,onClick:s,className:"delete-term",children:"\u5220\u9664"})]})},je=Te,Re=q.Z.Option,En="_",Ne=function(e,t){return e?"".concat(e).concat(En).concat(t):String(t)},$n=function(e){return e&&e.split(En)||[]},Ee=[{label:"\u6216",value:"and"},{label:"\u4E14",value:"or"}],Pe=function r(e){var t=e.data,i=e.pos,u=e.setElementTerm,n=e.onAddGroup,l=e.onAddTerm,s=e.onOpsChange,v=e.onDeleteTerm,c=e.onTermChange,m=function(){var o=$n(i),d=t.children;return o.push(String(d.length-1)),o.join(En)},R=function(o){typeof s=="function"&&s(i,F()(F()({},t),{},{ops:o}))},p=function(){var o={},d=m();typeof l=="function"&&l(d,o)},T=function(){var o={ops:tn.AND,children:[{}]},d=m();typeof n=="function"&&n(d,o)},B=t.children,D=t.ops,w=D||tn.AND;return console.log("RelationGroup data: ",t),(0,a.jsxs)("div",{className:"vui-relation-group",children:[(0,a.jsx)("div",{className:"relational",children:(0,a.jsx)(q.Z,{className:"relation-sign",value:w,onChange:R,children:Ee.map(function(h,o){return(0,a.jsx)(Re,{value:h.value,children:h.label},o)})})}),(0,a.jsxs)("div",{className:"conditions",children:[B.map(function(h,o){var d=h,N=d.children,b=Ne(i,o);return N&&N.length?(0,a.jsx)(r,{pos:b,data:h,setElementTerm:u,onAddGroup:n,onAddTerm:l,onOpsChange:s,onDeleteTerm:v,onTermChange:c},b):(0,a.jsx)(je,{pos:b,data:h,setElementTerm:u,onDeleteTerm:v,onTermChange:c},b)}),(0,a.jsxs)("div",{className:"operators",children:[(0,a.jsx)(Nn.ZP,{type:"primary",className:"add-term",onClick:p,children:"\u52A0\u6761\u4EF6"}),(0,a.jsx)(Nn.ZP,{type:"primary",className:"add-group",onClick:T,children:"\u52A0\u6761\u4EF6\u7EC4"})]})]})]})},we=Pe,Ae=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0;if(!t)return u;var n=$n(t),l=n.length-1;return(0,Ce.ZP)(e,function(s){var v={data:s,idx:0},c=s.children||[];n.forEach(function(m,R){var p=Number(m);if(R===l)switch(i){case"addTerm":case"addGroup":c.splice(p+1,0,u);break;case"deleteTerm":c.splice(p,1),c.length||v.data.splice(v.idx,1);break;default:c[p]=u}else v={data:c,idx:p},c=c[p]&&c[p].children||[]})})},tn;(function(r){r.AND="and",r.OR="or"})(tn||(tn={}));var z;(function(r){r.addGroup="addGroup",r.addTerm="addTerm",r.changeOps="changeOps",r.deleteTerm="deleteTerm",r.changeTerm="changeTerm"})(z||(z={}));var De={ops:tn.AND,children:[{}]},be=function(e){var t=e.value,i=e.onValueChange,u=e.setElementTerm,n=e.fromItemOnChange,l=(0,f.useState)(t||De),s=W()(l,2),v=s[0],c=s[1];(0,f.useEffect)(function(){n&&n(v)},[v]);var m=function(h,o,d){var N=Ae(v,h,d,o);typeof i=="function"&&i(N,d,o),c(N)},R=function(h,o){m(h,o,z.addGroup)},p=function(h,o){m(h,o,z.addTerm)},T=function(h,o){m(h,o,z.changeOps)},B=function(h,o){m(h,o,z.deleteTerm)},D=function(h,o){m(h,o,z.changeTerm)};return(0,a.jsx)("div",{className:"vui-relation-tree",children:(0,a.jsx)(we,{pos:"",data:v,setElementTerm:u,onAddGroup:R,onAddTerm:p,onOpsChange:T,onDeleteTerm:B,onTermChange:D})})},Me=be,Ve=function(e){var t=e.keyMap,i=e.handleMap,u=e.value,n=e.valueMap,l=e.onValueChange,s=function(c,m,R){return(0,a.jsx)(fe,{keyMap:t,handleMap:i,valueMap:n,pos:m,data:c,onChange:R})};return(0,a.jsx)(Me,{value:u,onValueChange:l,fromItemOnChange:e.onChange,setElementTerm:s})},Be=Ve}}]);
